# 内容管理模块

**在此模块完成课程及其相关内容管理**

# 一、基础工程搭建

## 1.1 需求分析

**内容管理系统**（content management system，CMS），是一种位于WEB前端（Web 服务器）和后端办公系统或流程（内容创作、编辑）之间的软件系统。内容的创作人员、编辑人员、发布人员使用内容管理系统来提交、修改、审批、发布内容。这里指的“内容”可能包括文件、表格、图片、数据库中的数据甚至视频等一切你想要发布到Internet、Intranet以及Extranet网站的信息。

本项目作为一个大型的在线教育平台，其内容管理模块主要对**课程及相关内容管理**，包括：课程的基本信息、课程图片、课程师资信息、课程的授课计划、课程视频、课程文档等内容的管理。 





## 1.2 业务流程

内容管理的业务由教学机构人员和平台的运营人员共同完成。

**教学机构人员的业务流程如下**：

1、登录教学机构。

2、维护课程信息，添加一门课程需要编辑课程的基本信息、上传课程图片、课程营销信息、课程计划、上传课程视频、课程师资信息等内容。

3、课程信息编辑完成，通过课程预览确认无误后提交课程审核。

4、待运营人员对课程审核通过后方可进行课程发布。

**运营人员的业务流程如下**：

1、查询待审核的课程信息。

2、审核课程信息。

3、提交审核结果。

下图是课程编辑与发布的整体流程。

![img](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/clip_image002.gif)

## 1.3 数据模型

共设计到9张表

![image-20231029210826042](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20231029210826042.png)

## 1.4 创建模块工程

### 1.4.1 介绍

我们要创建的就是**下面标红的内容管理模块**

![image-20231029211540123](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20231029211540123.png)

本项目是一个**前后端分离项目**，前端与后端开发人员之间主要依据接口进行开发。

下图是**前后端交互的流程图**：

1、前端请求后端服务提供的接口。（通常为http协议 ）

2、后端服务的控制层Controller接收前端的请求。

3、Contorller层调用Service层进行业务处理。

4、Service层调用Dao持久层对数据持久化。

![image-20231029211908225](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20231029211908225.png)

对于一个Springcloud工程，对于此模块我们会单独创建一个Controller接口层工程xuecheng-plus-content-api，这个模块里面只是接口，这个工程会调用Service

xuecheng-plus-content-service模块式Service模块，处理业务逻辑

Controller工程调用Service工程时需要传输一些数据，而完成此传输功能的模块式xuecheng-plus-content-mode模块工程，里面都是一些传输对象

**总结**

**xuecheng-plus-content-api**：接口工程，为前端提供接口。

**xuecheng-plus-content-service**: 业务工程，为接口工程提供业务支撑。

**xuecheng-plus-content-model**: 数据模型工程，存储数据模型类、数据传输类型等。

![image-20231029212238183](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20231029212238183.png)

**结合项目父工程、项目基础工程后**

假如说我们以后部署jar包时，部署xuecheng-plus-content的jar包即可

xuecheng-plus-parent父工程会管理整个大项目的依赖

**xuecheng-plus-content负责聚合xuecheng-plus-content-api、xuecheng-plus-content-service、xuecheng-plus-content-model**，而且只负责模块的聚合

![image-20231029212840781](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20231029212840781.png)

 



### 1.4.2 xuecheng-plus-content 聚合工程

* 首先在项目根目录创建**内容管理模块的父工程xuecheng-plus-content**

![image-20231029214827080](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20231029214827080.png)

![image-20231029215219848](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20231029215219848.png)



1. **创建完成，只保留pom.xml文件，删除多余的文件**。

   ![image-20231029215423159](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20231029215423159.png)

![image-20231029214903484](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20231029214903484.png)

2. **Maven坐标**。内容管理父工程的**主要职责是聚合内容管理接口和内容管理接口实现两个工程**，它的父工程是xuecheng-plus-parent

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    
    <parent>
        <artifactId>xuecheng-plus-parent</artifactId>
        <groupId>com.xuecheng</groupId>
        <version>0.0.1-SNAPSHOT</version>
        <relativePath>../xuecheng-plus-parent</relativePath>
    </parent>
    
    <artifactId>xuecheng-plus-content</artifactId>
    <name>xuecheng-plus-content</name>
    <description>xuecheng-plus-content</description>
    <packaging>pom</packaging>

  <modules>
    <module>xuecheng-plus-content-api</module>
    <module>xuecheng-plus-content-model</module>
    <module>xuecheng-plus-content-service</module>
   </modules>
</project>

```



* **在xuecheng-plus-content下创建xuecheng-plus-content-model数据模型工程**

![image-20231029215647710](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20231029215647710.png)

1. 创建完成，只保留包和pom.xml文件 ，删除多余的文件。

   比如删除启动类和配置文件

2. 修改pom.xml文件

   > 我们在配置文件中并没有配置relativePath，因为此项目和父工程的pom.xml文件在同级目录之中

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <artifactId>xuecheng-plus-content</artifactId>
        <groupId>com.xuecheng</groupId>
        <version>0.0.1-SNAPSHOT</version>
    </parent>
    <artifactId>xuecheng-plus-content-model</artifactId>
    

    <dependencies>
        <dependency>
            <groupId>com.xuecheng</groupId>
            <artifactId>xuecheng-plus-base</artifactId>
            <version>0.0.1-SNAPSHOT</version>
        </dependency>
    </dependencies>

</project>

```



* **在xuecheng-plus-content下创建xuecheng-plus-content-service接口实现工程**

![image-20231029220130200](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20231029220130200.png)

1. 创建完成，只保留包和pom.xml文件 ，删除多余的文件

   比如删除启动类和配置文件

2. pom.xml如下：

   > 我们在配置文件中并没有配置relativePath，因为此项目和父工程的pom.xml文件在同级目录之中

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <artifactId>xuecheng-plus-content</artifactId>
        <groupId>com.xuecheng</groupId>
        <version>0.0.1-SNAPSHOT</version>
    </parent>
    <artifactId>xuecheng-plus-content-service</artifactId>
    
        <dependencies>
        <dependency>
            <groupId>com.xuecheng</groupId>
            <artifactId>xuecheng-plus-content-model</artifactId>
            <version>0.0.1-SNAPSHOT</version>
        </dependency>
     </dependencies>
</project>

```



* **在xuecheng-plus-content下创建xuecheng-plus-content-api接口工程**

xuecheng-plus-content-api接口工程的父工程是xuecheng-plus-content，它依赖了xuecheng-plus-base基础工程

![image-20231029220529121](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20231029220529121.png)

1. 编辑pom.xml

   > 我们在配置文件中并没有配置relativePath，因为此项目和父工程的pom.xml文件在同级目录之中

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <artifactId>xuecheng-plus-content</artifactId>
        <groupId>com.xuecheng</groupId>
        <version>0.0.1-SNAPSHOT</version>
    </parent>
    <artifactId>xuecheng-plus-content-api</artifactId>


    <dependencies>
        <dependency>
            <groupId>com.xuecheng</groupId>
            <artifactId>xuecheng-plus-content-service</artifactId>
            <version>0.0.1-SNAPSHOT</version>
        </dependency>
    </dependencies>

</project>

```



### 1.4.3 模块演示

四个功能模块如下所示

![image-20231029221637895](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20231029221637895.png)



# 二、课程查询

## 2.1 需求分析

### 2.1.1 业务流程

课程查询的业务流程如下：

1、教学机构人员点击课程管理首先进入课程查询界面，如下：

![image-20231029224218893](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20231029224218893.png)

2.在课程进行列表查询页面输入查询条件查询课程信息

当不输入查询条件时输入全部课程信息。

输入查询条件查询符合条件的课程信息。

约束：本教学机构查询本机构的课程信息。

![img](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/clip_image004.gif)

### 2.1.2 数据模型

下边从查询条件、查询列表两个方面分析数据模型

* **查询条件**：

包括：课程名称、课程审核状态、课程发布状态

课程名称：可以模糊搜索

课程审核状态：未提交、已提交、审核通过、审核未通过

课程发布状态：未发布、已发布、已下线

因为是分页查询所以查询条件中还要包括当前页码、每页显示记录数。

* **查询结果**：

查询结果中包括：课程id、课程名称、任务数、创建时间、是否付费、审核状态、类型，操作

任务数：该课程所包含的课程计划数，即课程章节数。

是否付费：课程包括免费、收费两种。

类型：录播、直播。

因为是分页查询所以查询结果中还要包括总记录数、当前页、每页显示记录数。

 

## 2.2 生成PO类

**PO即持久对象**(Persistent Object)，它们是由一组属性和属性的get和set方法组成，**PO对应于数据库的表**

我们对应的这些类应该添加在xuecheng-plus-content-model工程中



### 2.2.1 新增Maven配置

xuecheng-plus-content-model模块引入mybatis的核心包和注解包，保证代码不出错即可，不用将Mybatis的包全部引进来

```xml
<!--存在mybatisplus注解添加相关注解保证不报错-->
        <dependency>
            <groupId>com.baomidou</groupId>
            <artifactId>mybatis-plus-annotation</artifactId>
            <version>${mybatis-plus-boot-starter.version}</version>
        </dependency>
        <dependency>
            <groupId>com.baomidou</groupId>
            <artifactId>mybatis-plus-core</artifactId>
            <version>${mybatis-plus-boot-starter.version}</version>
        </dependency>
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
        </dependency>

```

### 2.2.2 课程基本信息表

![image-20231029231721091](https://picture-typora-zhangjingqi.oss-cn-beijing.aliyuncs.com/image-20231029231721091.png)

```java
/**
 * <p>
 * 课程基本信息
 * </p>
 */
@Data
@TableName("course_base")
public class CourseBase implements Serializable {

    private static final long serialVersionUID = 1L;

    /**
     * 主键
     */
    @TableId(value = "id", type = IdType.AUTO)
    private Long id;

    /**
     * 机构ID
     */
    private Long companyId;

    /**
     * 机构名称
     */
    private String companyName;

    /**
     * 课程名称
     */
    private String name;

    /**
     * 适用人群
     */
    private String users;

    /**
     * 课程标签
     */
    private String tags;

    /**
     * 大分类
     */
    private String mt;

    /**
     * 小分类
     */
    private String st;

    /**
     * 课程等级
     */
    private String grade;

    /**
     * 教育模式(common普通，record 录播，live直播等）
     */
    private String teachmode;

    /**
     * 课程介绍
     */
    private String description;

    /**
     * 课程图片
     */
    private String pic;

    /**
     * 创建时间
     */
    @TableField(fill = FieldFill.INSERT)
    private LocalDateTime createDate;

    /**
     * 修改时间
     */
    @TableField(fill = FieldFill.INSERT_UPDATE)
    private LocalDateTime changeDate;

    /**
     * 创建人
     */
    private String createPeople;

    /**
     * 更新人
     */
    private String changePeople;

    /**
     * 审核状态
     */
    private String auditStatus;

    /**
     * 课程发布状态 未发布  已发布 下线
     */
    private String status;


}
```



## 2.3 接口设计分析

**设计一个接口需要包括以下几个方面**：

* **协议** 

通常协议采用HTTP，查询类接口通常为get或post，查询条件较少的使用get，较多的使用post。

本接口使用 http post。

还要确定content-type，参数以什么数据格式提交，结果以什么数据格式响应。

一般情况没有特殊情况结果以json 格式响应。

* **分析请求参数**

根据前边对数据模型的分析，请求参数为：课程名称、课程审核状态、当前页码、每页显示记录数。

根据分析的请求参数定义模型类。

* **分析响应结果**

根据前边对数据模型的分析，响应结果为数据列表加一些分页信息（总记录数、当前页、每页显示记录数）。

数据列表中数据的属性包括：课程id、课程名称、任务数、创建时间、审核状态、类型。

**注意**：**查询结果中的审核状态为数据字典中的代码字段，前端会根据审核状态代码 找到对应的名称显示**。

根据分析的响应结果定义模型类。

* **分析完成，使用SpringBoot注解开发一个Http接口**。

* **使用接口文档工具查看接口的内容**。

* **接口中调用Service方法完成业务处理**。

 

## 2.4 创建模型类

### 2.4.1 分页查询公用参数

**据接口分析需要定义模型类接收请求的参数，并定义模型类用于响应结果**

> 这些一般是公共使用的，所以放在xuecheng-plus-base工程中

```java
/**
 * @description 分页查询通用参数
 */
@Data
@ToString
public class PageParams {

  //当前页码
  private Long pageNo = 1L;

  //每页记录数默认值
  private Long pageSize =10L;

  public PageParams(){

  }

  public PageParams(long pageNo,long pageSize){
      this.pageNo = pageNo;
      this.pageSize = pageSize;
  }
  
}
```





### 2.4.2 分页查询结果模型类

针对分页查询结果经过分析也存在固定的数据和格式，所以在base工程定义一个基础的模型类

**据接口分析需要定义模型类接收请求的参数，并定义模型类用于响应结果**

> 这些一般是公共使用的，所以放在xuecheng-plus-base工程中

```java
/**
 * @description 分页查询结果模型类
 */
@Data
@ToString
public class PageResult<T> implements Serializable {

    // 数据列表
    private List<T> items;

    //总记录数
    private long counts;

    //当前页码
    private long page;

    //每页记录数
    private long pageSize;

    public PageResult(List<T> items, long counts, long page, long pageSize) {
        this.items = items;
        this.counts = counts;
        this.page = page;
        this.pageSize = pageSize;
    }

}
```



### 2.4.2 查询条件模型类

这个类只有在是在xuecheng-plus-content工程模块中使用，所以我们**把下面这个类添加在xuecheng-plus-content-model模块即可**

```java
/**
 * @description 课程查询参数Dto
 */
 @Data
 @ToString
public class QueryCourseParamsDto {

  //审核状态
 private String auditStatus;
 //课程名称
 private String courseName;
  //发布状态
 private String publishStatus;

}
```



## 2.5 定义接口

我们定义的接口要写在xuecheng-plus-content-api工程中